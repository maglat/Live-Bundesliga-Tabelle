<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>1. Bundesliga‚ÄëTabelle</title>
  <style>
    :root {
      --cl-color: #4a90d9;
      --el-color: #f5a623;
      --rel-color: #e67e22;
      --drop-color: #e74c3c;
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --text-primary: #212529;
      --text-secondary: #6c757d;
      --border-color: #dee2e6;
      --hover-shadow: rgba(0,0,0,0.15);
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-primary: #1a1a2e;
        --bg-secondary: #16213e;
        --text-primary: #e8e8e8;
        --text-secondary: #a0a0a0;
        --border-color: #2a2a4a;
        --hover-shadow: rgba(0,0,0,0.4);
      }
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      margin: 0;
      padding: 20px;
      line-height: 1.6;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    h1 {
      margin: 0;
      font-size: 1.8rem;
      font-weight: 700;
    }
    .controls {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    .control-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    select {
      padding: 8px 12px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 0.95rem;
      background: var(--bg-primary);
      color: var(--text-primary);
      cursor: pointer;
      min-width: 140px;
      transition: border-color 0.2s ease;
    }
    select:hover {
      border-color: var(--cl-color);
    }
    select:focus {
      outline: none;
      border-color: var(--cl-color);
      box-shadow: 0 0 0 3px rgba(74, 144, 217, 0.15);
    }
    .matchday-info {
      font-size: 1.1rem;
      color: var(--text-secondary);
      margin-bottom: 20px;
      padding: 12px 16px;
      background: var(--bg-secondary);
      border-radius: 8px;
      display: inline-block;
    }
    #loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
      font-size: 1.1rem;
      animation: pulse 1.5s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }
    #table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    th, td {
      padding: 14px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }
    th {
      background: var(--bg-secondary);
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
    }
    tr {
      transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    tr:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--hover-shadow);
      z-index: 1;
      position: relative;
    }
    tr[data-rank="1"], tr[data-rank="2"], tr[data-rank="3"], tr[data-rank="4"] {
      border-left: 4px solid var(--cl-color);
    }
    tr[data-rank="5"], tr[data-rank="6"] {
      border-left: 4px solid var(--el-color);
    }
    tr[data-rank="16"] {
      border-left: 4px solid var(--rel-color);
    }
    tr[data-rank="17"], tr[data-rank="18"] {
      border-left: 4px solid var(--drop-color);
    }
    .team-cell {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 500;
    }
    .team-logo {
      width: 24px;
      height: 24px;
      object-fit: contain;
    }
    .rank {
      font-weight: 700;
      color: var(--text-primary);
      width: 32px;
      display: inline-block;
    }
    .legend {
      margin-top: 32px;
      padding: 20px;
      background: var(--bg-secondary);
      border-radius: 10px;
    }
    .legend h3 {
      margin: 0 0 12px;
      font-size: 0.95rem;
      font-weight: 600;
    }
    .legend-items {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
    }
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
    }
    .coffee-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: #ffffff;
      color: #222;
      border: 1px solid #e0e0e0;
      border-radius: 50px;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.95rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: all 0.2s ease;
    }
    .coffee-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }
    .coffee-btn svg {
      width: 20px;
      height: 20px;
    }
    .reload-btn {
      padding: 10px 20px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }
    .reload-btn:hover {
      background: var(--border-color);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>1. Bundesliga‚ÄëTabelle</h1>
      <a href="https://buymeacoffee.com/maglat" target="_blank" class="coffee-btn" title="Unterst√ºtze das Projekt">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-12.5c-2.41 0-4.37 1.96-4.37 4.37h8.74c0-2.41-1.96-4.37-4.37-4.37z"/></svg>
        Buy me a coffee
      </a>
    </div>
    <div class="controls">
      <div class="control-group">
        <label for="league-select">Liga:</label>
        <select id="league-select">
          <option value="bl1">1. Bundesliga</option>
          <option value="bl2">2. Bundesliga</option>
          <option value="bl3">3. Liga</option>
        </select>
      </div>
      <div class="control-group">
        <label for="season-select">Saison:</label>
        <select id="season-select"></select>
      </div>
      <div class="control-group" style="justify-content: flex-end;">
        <button class="reload-btn" onclick="loadTable()">üîÑ Neu laden</button>
      </div>
    </div>
    <div class="matchday-info" id="matchday-info">Aktueller Spieltag: - / 34</div>
    <div id="loading">Lade Daten ‚Ä¶</div>
    <table id="table" style="display:none;">
      <thead>
        <tr>
          <th style="width:50px;">#</th>
          <th>Mannschaft</th>
          <th style="width:60px;">Sp</th>
          <th style="width:60px;">S</th>
          <th style="width:60px;">U</th>
          <th style="width:60px;">N</th>
          <th style="width:70px;">Tore</th>
          <th style="width:60px;">TD</th>
          <th style="width:60px;">Pkt</th>
        </tr>
      </thead>
      <tbody id="table-body"></tbody>
    </table>
    <div class="legend">
      <h3>Legende:</h3>
      <div class="legend-items">
        <div class="legend-item">
          <div class="legend-color" style="background: var(--cl-color);"></div>
          <span>Champions‚ÄëLeague (Pl√§tze 1‚Äë4)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: var(--el-color);"></div>
          <span>Europa‚ÄëLeague (Pl√§tze 5‚Äë6)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: var(--rel-color);"></div>
          <span>Relegations‚ÄëPlay‚Äëoff (Platz 16)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: var(--drop-color);"></div>
          <span>Direkter Abstieg (Pl√§tze 17‚Äë18)</span>
        </div>
      </div>
    </div>
  </div>
  <script>
    let currentLeague = "bl1";
    let currentSeason = "";
    const leagueNames = {
      "bl1": "1. Bundesliga",
      "bl2": "2. Bundesliga",
      "bl3": "3. Liga"
    };
    function init() {
      populateSeasons();
      document.getElementById("league-select").addEventListener("change", (e) => {
        currentLeague = e.target.value;
        populateSeasons();
        loadTable();
        updatePageTitle();
      });
      document.getElementById("season-select").addEventListener("change", (e) => {
        currentSeason = e.target.value;
        loadTable();
        updatePageTitle();
      });
      loadTable();
      updatePageTitle();
    }
    function populateSeasons() {
      const seasonSelect = document.getElementById("season-select");
      seasonSelect.innerHTML = "";
      const currentYear = new Date().getFullYear();
      const currentMonth = new Date().getMonth();
      const startYear = currentMonth >= 7 ? currentYear : currentYear - 1;
      for (let year = startYear; year >= 2010; year--) {
        const nextYear = (year + 1).toString().slice(-2);
        const seasonKey = year + "/" + nextYear;
        const option = document.createElement("option");
        option.value = seasonKey;
        option.textContent = year + "/" + nextYear;
        seasonSelect.appendChild(option);
      }
      currentSeason = seasonSelect.value;
    }
    function updatePageTitle() {
      const leagueName = leagueNames[currentLeague] || currentLeague;
      const season = currentSeason;
      document.title = season ? `${leagueName} ${season}` : leagueName;
    }
    async function loadTable() {
      const loading = document.getElementById("loading");
      const table = document.getElementById("table");
      const matchdayInfo = document.getElementById("matchday-info");
      loading.style.display = "block";
      table.style.display = "none";
      try {
        const apiUrl = `https://api.openligadb.de/v1/${currentLeague == "bl1" ? "bl_table/bl1" : currentLeague == "bl2" ? "bl_table/bl2" : "bl_table/bl3"}/${currentSeason}`;
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error("API-Fehler: " + response.status);
        const data = await response.json();
        renderTable(data);
        const matchdayUrl = `https://api.openligadb.de/v1/${currentLeague == "bl1" ? "bl_matchdata/bl1" : currentLeague == "bl2" ? "bl_matchdata/bl2" : "bl_matchdata/bl3"}/${currentSeason}/current`;
        const matchdayResponse = await fetch(matchdayUrl);
        if (matchdayResponse.ok) {
          const matchdayData = await matchdayResponse.json();
          const maxMatchday = matchdayData.matchDay ? matchdayData.matchDay : "-";
          matchdayInfo.textContent = `Aktueller Spieltag: ${maxMatchday} / 34`;
        } else {
          matchdayInfo.textContent = "Aktueller Spieltag: - / 34";
        }
      } catch (error) {
        console.error("Error loading table:", error);
        loading.innerHTML = `‚ö†Ô∏è Fehler beim Laden der Daten<br><small>${error.message}</small><br><br><button class="reload-btn" onclick="loadTable()">Erneut versuchen</button>`;
      }
    }
    function renderTable(data) {
      const tbody = document.getElementById("table-body");
      const loading = document.getElementById("loading");
      const table = document.getElementById("table");
      tbody.innerHTML = "";
      if (!data || data.length === 0) {
        loading.innerHTML = "‚ö†Ô∏è Keine Daten f√ºr diese Saison verf√ºgbar";
        return;
      }
      data.forEach((team, index) => {
        const tr = document.createElement("tr");
        tr.dataset.rank = team.rank || index + 1;
        tr.style.animationDelay = `${index * 0.03}s`;
        const logoUrl = team.teamIconUrl || `https://tmssl.akamaized.net/images/wappen/${team.teamId ? "head/" + team.teamId : "placeholder"}`;
        const logoImg = `<img class="team-logo" src="${logoUrl}" alt="${team.teamName}" loading="lazy" onerror="this.style.display='none'">`;
        tr.innerHTML = `
          <td><span class="rank">${team.rank || index + 1}</span></td>
          <td><div class="team-cell">${logoImg}${team.teamName}</div></td>
          <td>${team.matches || "-"}</td>
          <td>${team.wins || "-"}</td>
          <td>${team.draws || "-"}</td>
          <td>${team.losses || "-"}</td>
          <td>${team.goals || "-"}</td>
          <td>${team.goalDiff > 0 ? "+" + team.goalDiff : team.goalDiff || "-"}</td>
          <td><strong>${team.points || "-"}</strong></td>
        `;
        tbody.appendChild(tr);
      });
      loading.style.display = "none";
      table.style.display = "table";
    }
    init();
  </script>
</body>
</html>