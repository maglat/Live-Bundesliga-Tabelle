<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1. Bundesliga-Tabelle</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f8f9fa;
            color: #212529;
            line-height: 1.6;
            padding: 2rem 1rem;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        h1 {
            font-size: 1.75rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .btn-buy-coffee {
            background: #ff8130;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(255,129,48,0.3);
        }
        .btn-buy-coffee:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255,129,48,0.4);
        }
        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        .control-group label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            color: #6c757d;
        }
        .control-group select {
            padding: 0.6rem 2rem 0.6rem 0.75rem;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background-color: #fff;
            color: #212529;
            font-size: 0.95rem;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            min-width: 180px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .control-group select:hover, .control-group select:focus {
            border-color: #4c6ef5;
            outline: none;
            box-shadow: 0 0 0 3px rgba(76,110,245,0.15);
        }
        .matchday-info {
            background: #fff;
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 2px 8px rgba(0,0,0,.04);
            border: 1px solid #e9ecef;
        }
        .matchday-info i {
            font-size: 1.25rem;
            color: #4c6ef5;
        }
        .matchday-info span {
            font-weight: 600;
            color: #6c757d;
        }
        .matchday-info strong {
            color: #212529;
            font-weight: 700;
        }
        .table-container {
            background: #fff;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0,0,0,.08);
            border: 1px solid #e9ecef;
        }
        .table-header {
            display: grid;
            grid-template-columns: 3rem 2.5rem 1fr repeat(4, 4rem);
            padding: 1rem 1.25rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6c757d;
            border-bottom: 1px solid #e9ecef;
        }
        .table-row {
            display: grid;
            grid-template-columns: 3rem 2.5rem 1fr repeat(4, 4rem);
            padding: 1rem 1.25rem;
            border-bottom: 1px solid #e9ecef;
            align-items: center;
            transition: all 0.2s ease;
        }
        .table-row:last-child {
            border-bottom: none;
        }
        .table-row:hover {
            background: rgba(76,110,245,0.04);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,.08);
        }
        .table-row .rank {
            font-weight: 700;
            font-size: 0.9rem;
            color: #6c757d;
            text-align: center;
        }
        .table-row .logo {
            width: 28px;
            height: 28px;
            object-fit: contain;
        }
        .table-row .team {
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .table-row .stat {
            text-align: center;
            font-size: 0.95rem;
            font-weight: 500;
            color: #6c757d;
        }
        .table-row.champ, .table-row.europa, .table-row.relegation, .table-row.abstieg {
            position: relative;
        }
        .table-row.champ {
            background: linear-gradient(90deg, rgba(162,86,214,0.08) 0%, transparent 30%);
        }
        .table-row.champ .rank {
            color: #a256d6;
        }
        .table-row.europa {
            background: linear-gradient(90deg, rgba(76,110,245,0.08) 0%, transparent 30%);
        }
        .table-row.europa .rank {
            color: #4c6ef5;
        }
        .table-row.relegation {
            background: linear-gradient(90deg, rgba(250,176,5,0.08) 0%, transparent 30%);
        }
        .table-row.relegation .rank {
            color: #fab005;
        }
        .table-row.abstieg {
            background: linear-gradient(90deg, rgba(250,82,82,0.08) 0%, transparent 30%);
        }
        .table-row.abstieg .rank {
            color: #fa5252;
        }
        .points {
            font-weight: 700 !important;
            color: #212529 !important;
        }
        .loading {
            padding: 3rem;
            text-align: center;
            color: #6c757d;
        }
        .loading i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }
        .error-message {
            padding: 3rem;
            text-align: center;
            color: #6c757d;
        }
        .error-message i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #fa5252;
        }
        .error-message .retry-btn {
            background: #4c6ef5;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 1rem;
            transition: all 0.2s ease;
        }
        .error-message .retry-btn:hover {
            background: #364fc7;
        }
        .legend {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #fff;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }
        .legend h3 {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1rem;
            color: #6c757d;
        }
        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }
        .legend-color.champ { background: #a256d6; }
        .legend-color.europa { background: #4c6ef5; }
        .legend-color.relegation { background: #fab005; }
        .legend-color.abstieg { background: #fa5252; }
        .footer {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-futbol" style="color:#d82626"></i> 1. Bundesliga-Tabelle</h1>
            <a href="https://www.buymeacoffee.com/maglat" target="_blank" class="btn-buy-coffee"><i class="fas fa-coffee"></i> Buy me a coffee</a>
        </header>
        
        <div class="controls">
            <div class="control-group">
                <label for="league-select">Liga</label>
                <select id="league-select">
                    <option value="bl1">1. Bundesliga</option>
                    <option value="bl2">2. Bundesliga</option>
                    <option value="bl3">3. Liga</option>
                </select>
            </div>
            <div class="control-group">
                <label for="season-select">Saison</label>
                <select id="season-select"></select>
            </div>
        </div>

        <div class="matchday-info">
            <i class="fas fa-calendar-alt"></i>
            <span>Aktueller Spieltag: <strong id="current-matchday">- / 34</strong></span>
        </div>

        <div class="table-container">
            <div class="table-header">
                <div>#</div>
                <div></div>
                <div>Verein</div>
                <div>Sp.</div>
                <div>S</div>
                <div>N</div>
                <div>TD</div>
                <div>Pkt.</div>
            </div>
            <div id="table-body">
                <div class="loading"><i class="fas fa-spinner"></i><br>Lade Daten…</div>
            </div>
        </div>

        <div class="legend">
            <h3>Legende</h3>
            <div class="legend-items">
                <div class="legend-item"><div class="legend-color champ"></div> Champions‑League (Plätze 1‑4)</div>
                <div class="legend-item"><div class="legend-color europa"></div> Europa‑League (Plätze 5‑6)</div>
                <div class="legend-item"><div class="legend-color relegation"></div> Relegations‑Play‑off (Platz 16)</div>
                <div class="legend-item"><div class="legend-color abstieg"></div> Direkter Abstieg (Plätze 17‑18)</div>
            </div>
        </div>
    </div>

    <script>
        const currentYear = new Date().getFullYear();
        const seasonStartYear = currentYear - (new Date().getMonth() < 7 ? 1 : 0);
        
        const leagueSelect = document.getElementById('league-select');
        const seasonSelect = document.getElementById('season-select');
        const tableBody = document.getElementById('table-body');
        const currentMatchdayEl = document.getElementById('current-matchday');

        for (let year = seasonStartYear; year >= 2018; year--) {
            const option = document.createElement('option');
            option.value = `${year}/${year + 1}`;
            option.textContent = `${year}/${year + 1}`;
            if (year === seasonStartYear) option.selected = true;
            seasonSelect.appendChild(option);
        }

        const leagueNames = {
            'bl1': '1. Bundesliga',
            'bl2': '2. Bundesliga',
            'bl3': '3. Liga'
        };

        async function fetchTable() {
            const league = leagueSelect.value;
            const season = seasonSelect.value;
            const apiUrl = `https://api.openligadb.de/v1/${league}/${season}/bl-table`;

            tableBody.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i><br>Lade Daten…</div>';
            currentMatchdayEl.textContent = '- / 34';

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                
                const matchday = data.currentMatchdayId ?? data[0]?.matchday ?? 1;
                const totalMatchdays = data.length > 0 && data[data.length-1]?.matchday ? data[data.length-1].matchday : 34;
                currentMatchdayEl.textContent = `${matchday} / ${totalMatchdays}`;

                if (!data || data.length === 0) {
                    tableBody.innerHTML = '<div class="error-message"><i class="fas fa-exclamation-triangle"></i><p>Keine Daten für diese Saison verfügbar.</p></div>';
                    return;
                }

                tableBody.innerHTML = data.map((team, i) => `
                    <div class="table-row ${['pl-1','pl-2','pl-3','pl-4'].includes(i+1) ? 'champ' : 
                                             ['pl-5','pl-6'].includes(i+1) ? 'europa' :
                                             ['pl-16'].includes(i+1) ? 'relegation' :
                                             ['pl-17','pl-18'].includes(i+1) ? 'abstieg' : ''}">
                        <div class="rank">${i+1}</div>
                        <div class="logo-container"><img class="logo" src="${team.teamIconUrl}" alt="${team.teamName}"></div>
                        <div class="team">${team.teamName}</div>
                        <div class="stat">${team.matches || team.matchResults?.length || 0}</div>
                        <div class="stat">${team.wins || 0}</div>
                        <div class="stat">${team.losses || 0}</div>
                        <div class="stat">${team.goalDiff || 0}</div>
                        <div class="stat points">${team.points ?? "-"}</div>
                    </div>
                `).join('');

                document.title = `${leagueNames[league]} ${season}`;

            } catch (error) {
                console.error('Fetch error:', error);
                tableBody.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>Daten konnten nicht geladen werden.</p>
                        <button class="retry-btn" onclick="fetchTable()">Erneut versuchen</button>
                    </div>`;
            }
        }

        leagueSelect.addEventListener('change', fetchTable);
        seasonSelect.addEventListener('change', fetchTable);

        fetchTable();
    </script>

    <footer class="footer">
        <p>Powered by OpenLigaDB API</p>
    </footer>
</body>
</html>